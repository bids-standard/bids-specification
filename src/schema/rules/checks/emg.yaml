---
EMGChannelCountReq:
  issue:
    code: EMG_CHANNEL_COUNT_MISMATCH
    message: |
      The EMGChannelCount metadata does not match the number of channels
      with type EMG in the associated channels.tsv file.
    level: warning
  selectors:
    - suffix == "emg"
    - type(sidecar.EMGChannelCount) != "null"
    - associations.channels.type
  checks:
    - sidecar.EMGChannelCount == count(associations.channels.type, "EMG")

EMGCoordSysMatch:
  issue:
    code: EMG_COORD_SYS_MISMATCH
    message: |
      Some values in the coordinate_system column of *_electrodes.tsv are not present as
      space entities in *_coordsystem.json files.
    level: error
  selectors:
    - datatype == "emg"
    - suffix == "electrodes"
    - columns.coordinate_system
  checks:
    # ↓ any LABEL that is mentioned in `coordinate_system` column of `*_electrodes.tsv`
    # ↓ must have an associated file `*_space-LABEL_coordsystem.json`
    - |
      length(
        intersects(
          unique(columns.coordinate_system),
          associations.coordsystems.spaces
        )
      ) == length(unique(columns.coordinate_system))

EMGCoordSysParents:
  issue:
    code: EMG_COORD_SYS_PARENTS
    message: Some parent coordinate systems were not found.
    level: error
  selectors:
    - datatype == "emg"
    - suffix == "electrodes"
    - length(associations.coordsystems.ParentCoordinateSystems)
  checks:
    # ↓ any LABEL that is mentioned as a ParentCoordinateSystem must have an associated
    # ↓ file `*_space-LABEL_coordsystem.json`
    - |
      length(
        intersects(
          unique(associations.coordsystems.ParentCoordinateSystems),
          associations.coordsystems.spaces
        )
      ) == length(unique(associations.coordsystems.ParentCoordinateSystems))
