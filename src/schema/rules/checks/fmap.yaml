# Rules for fieldmap data that are not defined in tables.
---
# 83
EchoTime12DifferenceUnreasonable:
  issue:
    code: ECHOTIME1_2_DIFFERENCE_UNREASONABLE
    message: |
      The value of (EchoTime2 - EchoTime1) should be within the range of 0.0001 - 0.01.
    level: error
  selectors:
    - suffix == "phasediff"
  checks:
    - sidecar.EchoTime2 - sidecar.EchoTime1 >= 0.0001
    - sidecar.EchoTime2 - sidecar.EchoTime1 <= 0.01

# 91
FmapFieldmapWithoutMagnitude:
  issue:
    code: FIELDMAP_WITHOUT_MAGNITUDE_FILE
    message: |
      '_fieldmap.nii[.gz]' file does not have accompanying '_magnitude.nii[.gz]' file.
    level: error
  selectors:
    - suffix == "fieldmap"
  checks:
    - '"magnitude" in associations'

# 92
FmapPhasediffWithoutMagnitude:
  issue:
    code: MISSING_MAGNITUDE1_FILE
    message: |
      Each '_phasediff.nii[.gz]' file should be associations with a '_magnitude1.nii[.gz]' file.
    level: warning
  selectors:
    - suffix == "phasediff"
  checks:
    - '"magnitude1" in associations'

# 94
MagnitudeFileWithTooManyDimensions:
  issue:
    code: MAGNITUDE_FILE_WITH_TOO_MANY_DIMENSIONS
    message: |
      _magnitude1.nii[.gz] and _magnitude2.nii[.gz] files must have exactly three dimensions.
    level: error
  selectors:
    - intersects([suffix], ['magnitude1', 'magnitude2'])
    - nifti_header != null
  checks:
    - nifti_header.dim[0] == 3
