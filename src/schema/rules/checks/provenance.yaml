# Rules for provenance files
---

ProvenanceEntityMissing:
  issue:
    code: PROVENANCE_ENTITY_MISSING
    message: |
      A provenance.tsv file lists a "prov" entity that was not found in
      the dataset.
    level: error
  selectors:
    - suffix == 'provenance'
    - extension == '.tsv'
  checks:
    - |
      allequal(
        sorted(intersects(columns.provenance_id, dataset.prov.entities)),
        sorted(dataset.prov.entities)
      )

ProvenanceOutsideProvDir:
  issue:
    code: PROVENANCE_OUTSIDE_PROV_DIR
    message: |
      A provenance.tsv file is outside the prov directory.
    level: error
  selectors:
    - suffix == 'provenance'
    - extension == '.tsv'
  checks:
    - datatype == 'prov'
