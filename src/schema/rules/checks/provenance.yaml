# Rules for provenance files
---

ProvenanceEntityMissing:
  issue:
    code: PROVENANCE_ENTITY_MISSING
    message: |
      A provenance.tsv file lists a "prov" entity that was not found in
      the dataset.
    level: error
  selectors:
    - suffix == 'provenance'
    - extension == '.tsv'
  checks:
    - |
      allequal(
        sorted(intersects(columns.provenance_id, dataset.subjects.participant_id)),
        sorted(dataset.subjects.participant_id)
      )
