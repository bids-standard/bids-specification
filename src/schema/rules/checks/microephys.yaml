---
# For non-microephys modalities, electrodes.tsv always requires coordsystem.json
RequiredCoordsystem:
  issue:
    code: REQUIRED_COORDSYSTEM
    message: |
      If an electrodes.tsv file is provided, an associated coordsystem.json must also be present.
    level: error
  selectors:
    - suffix == "electrodes"
    - extension == ".tsv"
    - '!intersects([datatype], ["ecephys", "icephys"])'
  checks:
    - associations.coordsystem != null

# For microephys, only space-labeled electrodes.tsv requires coordsystem.json
MicroephysRequiredCoordsystemWithSpace:
  issue:
    code: MICROEPHYS_COORDSYSTEM_REQUIRED
    message: |
      For microelectrode electrophysiology data, if an electrodes.tsv file has a
      space-<label> entity, a corresponding coordsystem.json file with the same
      space label must also be present.
    level: error
  selectors:
    - intersects([datatype], ["ecephys", "icephys"])
    - suffix == "electrodes"
    - extension == ".tsv"
    - '"space" in entities'
  checks:
    - associations.coordsystem != null
