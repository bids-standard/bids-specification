---
# Rules for PET data that are not defined in tables.


PETFrameConsistency:
  issue:
    code: PET_FRAME_CONSISTENCY
    message: |
      The number of frames in this scan does not match the number of frames
      (as defined by FrameDuration and FrameTimesStart) in the
      associated '.json' file.
    level: error
  selectors:
    - suffix == 'pet'
    - type(nifti_header) != "null"
    - sidecar.FrameDuration
    - sidecar.FrameTimesStart
  checks:
    - |
      length(sidecar.FrameDuration) == nifti_header.dim[4] &&
      length(sidecar.FrameTimesStart) == nifti_header.dim[4] &&
      length(sidecar.FrameDuration) == length(sidecar.FrameTimesStart)

PETFrameConsistencyFrameDuration:
  issue:
    code: PET_FRAME_CONSISTENCY_FRAME_DURATION
    message: |
      The number of frames in this scan does not match the number of frames (as defined by FrameDuration) in the
      associated '.json' file.
    level: error
  selectors:
    - suffix == 'pet'
    - type(nifti_header) != "null"
    - sidecar.FrameDuration
  checks:
    - length(sidecar.FrameDuration) == nifti_header.dim[4]

PETFrameConsistencyFrameTimesStart:
  issue:
    code: PET_FRAME_CONSISTENCY_FRAME_TIMES_START
    message: |
      The number of frames in this scan does not match the number of frames (as defined by FrameTimesStart) in the
      associated '.json' file.
    level: error
  selectors:
    - suffix == 'pet'
    - type(nifti_header) != "null"
    - sidecar.FrameTimesStart
  checks:
    - length(sidecar.FrameTimesStart) == nifti_header.dim[4]


PETFrameConsistencyFrameDurationAndFrameTimesStart:
  issue:
    code: PET_FRAME_CONSISTENCY_FRAME_DURATION_AND_FRAME_TIMES_START
    message: |
      The number of frames as defined by FrameDuration and FrameTimesStart do not match in the
      associated '.json' file.
    level: error
  selectors:
    - suffix == 'pet'
    - sidecar.FrameDuration || sidecar.FrameTimesStart
    - sidecar.FrameTimesStart
  checks:
    - length(sidecar.FrameDuration) == length(sidecar.FrameTimesStart)
