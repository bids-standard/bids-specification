---
# 40
NiftiDimension:
  issue:
    code: NIFTI_DIMENSION
    message: |
      NIfTI file's header field for dimension information is blank or too short.
    level: warning
  selectors:
    - type(nifti_header) != "null"
  checks:
    - length(nifti_header.shape) > 0
    - min(nifti_header.shape) > 0

# 41
NiftiUnit:
  issue:
    code: NIFTI_UNIT
    message: |
      NIfTI file's header field for unit information for x, y, z, and t dimensions is underspecified.
    level: warning
  selectors:
    - type(nifti_header) != "null"
  checks:
    - nifti_header.xyzt_units.xyz != 'unknown'
    - nifti_header.dim[0] < 4 || nifti_header.xyzt_units.t != 'unknown'

# 42
NiftiPixdim:
  issue:
    code: NIFTI_PIXDIM
    message: |
      NIfTI file indicates 0-sized voxels.
    level: warning
  selectors:
    - suffix != 'pet'
    - type(nifti_header) != "null"
  checks:
    - min(nifti_header.voxel_sizes) > 0

NiftiPixdimPET:
  issue:
    code: NIFTI_PIXDIM_PET
    message: |
      NIfTI file indicates 0-sized voxels along spatial axes.
    level: warning
  selectors:
    - suffix == 'pet'
    - type(nifti_header) != "null"
  checks:
    - min([nifti_header.pixdim[1], nifti_header.pixdim[2], nifti_header.pixdim[3]]) > 0

# 60
XformCodes0:
  issue:
    code: SFORM_AND_QFORM_IN_IMAGE_HEADER_ARE_ZERO
    message: |
      sform_code and qform_code in the image header are 0.
      The image/file will be considered invalid or assumed to be in LAS orientation.
    level: warning
  selectors:
    - nifti_header != null
  checks:
    - nifti_header.qform_code != 0 || nifti_header.sform_code != 0

NiftiPEDir:
  issue:
    code: NIFTI_PE_DIRECTION_CONSISTENCY
    message: |
      The PhaseEncodingDirection and affine orientation indicate
      that the entity value (one of AP, PA, RL, LR, SI, IS) may be inaccurate.
    level: warning
  selectors:
    - type(nifti_header.axis_codes) != "null"
    - intersects([entities.direction], ["AP", "PA", "RL", "LR", "SI", "IS"])
    - sidecar.PhaseEncodingDirection
  checks:
    - |
      entities.direction[2 - length(sidecar.PhaseEncodingDirection)]
      == nifti_header.axis_codes[index(["i", "j", "k"], sidecar.PhaseEncodingDirection[0])]
