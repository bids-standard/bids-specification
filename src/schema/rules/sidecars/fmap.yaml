#
# Groups of related metadata fields
#
# Assumptions: never need disjunction of selectors
# Assumptions: top-to-bottom overrides is sufficient logic


---
# Fieldmap data
MRIFieldmapB0FieldIdentifier:
    selectors:
    - instrument == "mri"
    - datatype == "fmap"
    fields:
        B0FieldIdentifier: recommended

MRIFieldmapIntendedFor:
    selectors:
    - instrument == "mri"
    - datatype == "fmap"
    fields:
        IntendedFor:
            level: optional
            description_addendum: |
                This field is optional, and in case the fieldmaps do not correspond
                to any particular scans, it does not have to be filled.

# Case 1: Phase-difference map and at least one magnitude image
MRIFieldmapPhaseDifferencePhasediff:
    selectors:
    - instrument == "mri"
    - datatype == "fmap"
    - suffix == "phasediff"
    fields:
        EchoTime1: required
        EchoTime2: required

MRIFieldmapPhaseDifferenceMagnitude1:
    selectors:
    - instrument == "mri"
    - datatype == "fmap"
    - suffix == "magnitude1"
    fields:
        EchoTime1: required

MRIFieldmapPhaseDifferenceMagnitude2:
    selectors:
    - instrument == "mri"
    - datatype == "fmap"
    - suffix == "magnitude2"
    fields:
        EchoTime2: required

# Case 2: Two phase maps and two magnitude images
# NOTE: Need to check for presence of related files.
# For example, magnitude1 needs EchoTime__fmap only if phase1 file exists,
# but EchoTime1 if phasediff exists.
MRIFieldmapTwoPhase:
    selectors:
    - instrument == "mri"
    - datatype == "fmap"
    - '["phase1", "phase2", "magnitude1", "magnitude2"].includes(suffix)'
    fields:
        EchoTime__fmap: required

# Case 3: Direct field mapping
MRIFieldmapDirectFieldMapping:
    selectors:
    - instrument == "mri"
    - datatype == "fmap"
    - '["phase", "fieldmap"].includes(suffix)'
    fields:
        Units:
            level: required
            description_addendum: |
                Fieldmaps must be in units of Hertz (`"Hz"`),
                radians per second (`"rad/s"`), or Tesla (`"T"`).

# Case 4: Multiple phase encoded directions ("pepolar")
MRIFieldmapPepolar:
    selectors:
    - instrument == "mri"
    - datatype == "fmap"
    - suffix == "epi"
    fields:
        PhaseEncodingDirection: required
        TotalReadoutTime: required
