---
CommonDerivativeFields:
  selectors:
  - dataset.DatasetType == "derivative"
  fields:
    Description: recommended
    Sources: optional
    RawSources: optional

SpatialReferenceEntity:
  selectors:
  - dataset.DatasetType == "derivative"
  - '"space" in entities'
  fields:
    SpatialReference: recommended

SpatialReferenceNonStandard:
  selectors:
  - dataset.DatasetType == "derivative"
  - 'schema.objects.metadata._StandardTemplateCoordSys).includes(not(entities.space)'
  fields:
    SpatialReference: required

SpatialReferenceNoEntity:
  selectors:
  - dataset.DatasetType == "derivative"
  - '!("space" in entities)'
  fields:
    SpatialReference: required

# this needs to come before density and resolution overrides selected in a
# different way
MaskDerivatives:
  selectors:
  - dataset.DatasetType == "derivative"
  - suffix == "mask"
  fields:
    RawSources: required
    Type: recommended
    Atlas: optional
    Resolution: optional
    Density: optional

MaskDerivativesAtlas:
  selectors:
  - dataset.DatasetType == "derivative"
  - suffix == "mask"
  - '"label" in entities'
  fields:
    atlas: recommended

SegmentationCommon:
  selectors:
  - dataset.DatasetType == "derivative"
  - '["dseg", "probseg"].includes(suffix)'
  fields:
    Type: recommended
    Atlas: optional
    Resolution: optional
    Density: optional

# Derivatives -> Imaging data types
ImageDerivatives:
  selectors:
  - dataset.DatasetType == "derivative"
  - '["mri", "pet"].includes(modality)'
  - '[".nii", ".nii.gz"].includes(extension)'
  fields:
    SkullStripped: required

ImageDerivativeResEntity:
  selectors:
  - dataset.DatasetType == "derivative"
  - '["mri", "pet"].includes(modality)'
  - '"res" in entities'
  fields:
    Resolution: required

ImageDerivativeDenEntity:
  selectors:
  - dataset.DatasetType == "derivative"
  - '["mri", "pet"].includes(modality)'
  - '"den" in entities'
  fields:
    Density: required
