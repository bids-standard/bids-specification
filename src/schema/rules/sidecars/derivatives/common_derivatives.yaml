---
CommonDerivativeFields:
  selectors:
  - dataset.DatasetType == "derivative"
  fields:
    Description: RECOMMENDED
    Sources: OPTIONAL
    RawSources: OPTIONAL

SpatialReferenceEntity:
  selectors:
  - dataset.DatasetType == "derivative"
  - entities contains "space"
  fields:
    SpatialReference: RECOMMENDED

SpatialReferenceNonStandard:
  selectors:
  - dataset.DatasetType == "derivative"
  - not(entities.space in schema.objects.metadata._StandardTemplateCoordSys)
  fields:
    SpatialReference: REQUIRED

SpatialReferenceNoEntity:
  selectors:
  - dataset.DatasetType == "derivative"
  - not(entities contains "space")
  fields:
    SpatialReference: REQUIRED

# this needs to come before density and resolution overrides selected in a
# different way
MaskDerivatives:
  selectors:
  - dataset.DatasetType == "derivative"
  - suffix == "mask"
  fields:
    RawSources: REQUIRED
    Type: RECOMMENDED
    Atlas: OPTIONAL
    Resolution: OPTIONAL
    Density: OPTIONAL

MaskDerivativesAtlas:
  selectors:
  - dataset.DatasetType == "derivative"
  - suffix == "mask"
  - entities contains "label"
  fields:
    atlas: RECOMMENDED

SegmentationCommon:
  selectors:
  - dataset.DatasetType == "derivative"
  - suffix in ["dseg", "probseg"]
  fields:
    Type: RECOMMENDED
    Atlas: OPTIONAL
    Resolution: OPTIONAL
    Density: OPTIONAL

# Derivatives -> Imaging data types
ImageDerivatives:
  selectors:
  - dataset.DatasetType == "derivative"
  - modality in ["mri", "pet"]
  - extension in [".nii", ".nii.gz"]
  fields:
    SkullStripped: REQUIRED

ImageDerivativeResEntity:
  selectors:
  - dataset.DatasetType == "derivative"
  - modality in ["mri", "pet"]
  - entities contains "res"
  fields:
    Resolution: REQUIRED

ImageDerivativeDenEntity:
  selectors:
  - dataset.DatasetType == "derivative"
  - modality in ["mri", "pet"]
  - entities contains "den"
  fields:
    Density: REQUIRED
