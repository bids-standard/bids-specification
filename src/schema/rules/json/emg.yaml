#
# Groups of related metadata fields
#
# Assumptions: never need disjunction of selectors
# Assumptions: top-to-bottom overrides is sufficient logic

---
# ensure presence of fields relating to the EMG electrode positions
EMGCoordsystemPositions:
  selectors:
    - datatype == "emg"
    - suffix == "coordsystem"
  fields:
    EMGCoordinateSystem: required
    EMGCoordinateUnits: required
    EMGCoordinateSystemDescription:
      level: recommended
      level_addendum: required if `EMGCoordinateSystem` is `"Other"`
    ParentCoordinateSystem: optional
    AnchorCoordinates:
      level: optional
      level_addendum: required if `ParentCoordinateSystem` is present
    AnchorElectrode:
      level: optional
      level_addendum: required if `ParentCoordinateSystem` is present

# ensure description is present when coordsys is "other"
EMGCoordsystemOther:
  selectors:
    - datatype == "emg"
    - suffix == "coordsystem"
    - '"EMGCoordinateSystem" in json'
    - json.EMGCoordinateSystem == "Other"
  fields:
    EMGCoordinateSystemDescription: required

# ensure linkage between child (device) and parent (anatomical) coordinate systems
EMGChildCoordSystem:
  selectors:
    - datatype == "emg"
    - suffix == "coordsystem"
    - '"ParentCoordinateSystem" in json'
  fields:
    AnchorCoordinates: required
    AnchorElectrode: required

# ensure presence of fields relating to EMG placement
EMGPlacementSchemeInfo:
  selectors:
    - datatype == "emg"
    - suffix == "emg"
  fields:
    EMGPlacementScheme: required
    EMGPlacementSchemeDescription:
      level: optional
      level_addendum: required if `EMGPlacementScheme` is `"Other"`

# ensure description is present when EMGPlacementScheme is "other"
EMGPlacementSchemeDescription:
  selectors:
    - datatype == "emg"
    - suffix == "emg"
    - '"EMGPlacementScheme" in json'
    - json.EMGPlacementScheme == "Other"
  fields:
    EMGPlacementSchemeDescription:
      level: required
